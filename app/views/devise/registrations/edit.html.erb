<h2 class="text-center my-4">プロフィール編集</h2>

<div class="container" style="max-width: 500px;">
  <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, class: "needs-validation", novalidate: true }) do |f| %>
    <%= render "devise/shared/error_messages", resource: resource %>

    <!-- メールアドレス -->
    <div class="mb-3">
      <%= f.label :email, "メールアドレス", class: "form-label" %>
      <%= f.email_field :email, class: "form-control", autofocus: true, autocomplete: "email", required: true %>
      <div class="invalid-feedback">有効なメールアドレスを入力してください。</div>
    </div>

    <!-- 名前 -->
    <div class="mb-3">
      <%= f.label :name, "名前", class: "form-label" %>
      <%= f.text_field :name, class: "form-control", autofocus: true, autocomplete: "name", required: true, maxlength: 30 %>
      <div class="invalid-feedback">名前を入力してください（30文字以内）。</div>
    </div>

    <!-- プロフィール画像 -->
    <div class="mb-3">
      <%= f.label :profile_image, "プロフィール画像", class: "form-label" %>
      <%= f.file_field :profile_image, class: "form-control" %>
      <% if resource.profile_image.attached? %>
        <p>現在のプロフィール画像:</p>
        <%= image_tag resource.profile_image_as_thumbnail, class: "rounded-circle img-thumbnail" if resource.profile_image_as_thumbnail %>
      <% end %>
    </div>
    <!-- SNSリンク (オプション) -->
    <div class="sns-link my-4">
      <h4>SNS URL (任意)</h4>

      <div class="mb-3">
        <%= f.label :twitter, "Twitter URL", class: "form-label" %>
        <%= f.text_field :twitter, placeholder: "例: https://twitter.com/username", class: "form-control" %>
      </div>

      <div class="mb-3">
        <%= f.label :facebook, "Facebook URL", class: "form-label" %>
        <%= f.text_field :facebook, placeholder: "例: https://facebook.com/username", class: "form-control" %>
      </div>

      <div class="mb-3">
        <%= f.label :github, "GitHub URL", class: "form-label" %>
        <%= f.text_field :github, placeholder: "例: https://github.com/username", class: "form-control" %>
      </div>
    </div>

    <!-- 更新ボタン -->
    <div class="d-grid gap-2">
      <%= f.submit "更新する", class: "btn btn-primary" %>
    </div>
  <% end %>

  <!-- アカウント削除ボタン -->
  <div class="text-center mt-4">
    <h3>アカウントを削除</h3>
    <p>アカウントを削除したい場合はこちら</p>
    <%= button_to "アカウントを削除する", registration_path(resource_name), data: { confirm: "本当に良いですか?", turbo_confirm: "本当に良いですか?" }, method: :delete, class: "btn btn-danger" %>
  </div>

  <div class="mt-3">
    <%= link_to "戻る", :back, class: "btn btn-secondary" %>
  </div>
</div>

<script>
  function togglePasswordVisibility(fieldId, icon) {
    const field = document.getElementById(fieldId);
    const isPasswordHidden = field.type === "password";
    field.type = isPasswordHidden ? "text" : "password";
    icon.className = isPasswordHidden ? "bi bi-eye-slash" : "bi bi-eye";
  }

  // Bootstrapのカスタムバリデーション
  (function () {
    'use strict';
    var forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms)
      .forEach(function (form) {
        form.addEventListener('submit', function (event) {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
  })();
</script>
